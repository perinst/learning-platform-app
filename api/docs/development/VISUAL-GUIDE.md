# Visual Architecture Guide

## ğŸ“Š Request Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT APPLICATION                        â”‚
â”‚  (React/Vue/Angular/Mobile App)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP Request
                            â”‚ GET /api/lessons
                            â”‚ Header: Authorization: Bearer <token>
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EXPRESS SERVER                             â”‚
â”‚                   (src/index.ts)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Global Middleware                                  â”‚ â”‚
â”‚  â”‚     - CORS (cors.config.ts)                           â”‚ â”‚
â”‚  â”‚     - Security Headers (helmet)                       â”‚ â”‚
â”‚  â”‚     - Body Parser (json, urlencoded)                  â”‚ â”‚
â”‚  â”‚     - Request Logger                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Processed Request
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROUTER LAYER                              â”‚
â”‚                (routes/index.ts)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Match URL Pattern:                                    â”‚ â”‚
â”‚  â”‚  /api/auth/*    â†’ Auth Routes                         â”‚ â”‚
â”‚  â”‚  /api/lessons/* â†’ Lesson Routes  âœ“ MATCHED            â”‚ â”‚
â”‚  â”‚  /api/upload/*  â†’ Upload Routes                       â”‚ â”‚
â”‚  â”‚  /health        â†’ Health Check                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Route Matched
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LESSON ROUTES                                â”‚
â”‚              (routes/lesson.routes.ts)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  2. Route-Specific Middleware                          â”‚ â”‚
â”‚  â”‚     - authMiddleware (verify token)                   â”‚ â”‚
â”‚  â”‚     - adminMiddleware (check role) [if needed]        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Authenticated âœ“
                            â”‚ req.user = { user_id, email, name, role }
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LESSON CONTROLLER                           â”‚
â”‚           (controllers/lesson.controller.ts)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  3. Request Handling                                   â”‚ â”‚
â”‚  â”‚     - Parse request (params, query, body)             â”‚ â”‚
â”‚  â”‚     - Validate input                                   â”‚ â”‚
â”‚  â”‚     - Extract user info from req.user                 â”‚ â”‚
â”‚  â”‚     - Call service method                              â”‚ â”‚
â”‚  â”‚     - Format response                                  â”‚ â”‚
â”‚  â”‚     - Handle errors                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  getAllLessons(req, res) {                                  â”‚
â”‚      const userId = req.user.user_id;                       â”‚
â”‚      const lessons = await service.getAllLessons(userId);   â”‚
â”‚      res.json({ success: true, data: lessons });           â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Service Call
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LESSON SERVICE                             â”‚
â”‚            (services/lesson.service.ts)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  4. Business Logic                                     â”‚ â”‚
â”‚  â”‚     - Apply business rules                             â”‚ â”‚
â”‚  â”‚     - Transform data                                   â”‚ â”‚
â”‚  â”‚     - Coordinate operations                            â”‚ â”‚
â”‚  â”‚     - Make external API calls                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  async getAllLessons(userId: string) {                      â”‚
â”‚      const url = `${postgrestUrl}/rpc/get_lessons`;         â”‚
â”‚      const response = await fetch(url, {                    â”‚
â”‚          method: 'POST',                                     â”‚
â”‚          body: JSON.stringify({ p_user_id: userId })        â”‚
â”‚      });                                                     â”‚
â”‚      return await response.json();                          â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Database Query
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    POSTGREST API                             â”‚
â”‚                  (Port 3001)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  5. Data Access                                        â”‚ â”‚
â”‚  â”‚     - Execute database function                        â”‚ â”‚
â”‚  â”‚     - Apply RLS (Row Level Security)                  â”‚ â”‚
â”‚  â”‚     - Return filtered data                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ SQL Query
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   POSTGRESQL DATABASE                        â”‚
â”‚                     (Port 5432)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  6. Data Storage                                       â”‚ â”‚
â”‚  â”‚     - Execute SQL function                             â”‚ â”‚
â”‚  â”‚     - Apply access controls                            â”‚ â”‚
â”‚  â”‚     - Return result set                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Function: get_lessons_for_user(p_user_id)                 â”‚
â”‚  Returns: JSON array of lessons                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Data Returned
                            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Response flows back up the chain â”‚
         â”‚  Database â†’ PostgREST â†’ Service   â”‚
         â”‚  â†’ Controller â†’ Client             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Final Response
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT APPLICATION                        â”‚
â”‚  Receives:                                                   â”‚
â”‚  {                                                           â”‚
â”‚      "success": true,                                        â”‚
â”‚      "data": [                                               â”‚
â”‚          {                                                   â”‚
â”‚              "lesson_id": 1,                                 â”‚
â”‚              "title": "Introduction to TypeScript",          â”‚
â”‚              "content": "...",                               â”‚
â”‚              "is_published": true                            â”‚
â”‚          }                                                   â”‚
â”‚      ]                                                       â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Folder Structure Tree

```
api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                 âš™ï¸  Entry point - Start here
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/             ğŸ® HTTP Request Handlers
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts       â†’ Login, Register, Verify
â”‚   â”‚   â”œâ”€â”€ lesson.controller.ts     â†’ CRUD operations
â”‚   â”‚   â”œâ”€â”€ upload.controller.ts     â†’ Image uploads
â”‚   â”‚   â””â”€â”€ health.controller.ts     â†’ Health checks
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                ğŸ’¼ Business Logic Layer
â”‚   â”‚   â”œâ”€â”€ auth.service.ts          â†’ Authentication logic
â”‚   â”‚   â”œâ”€â”€ lesson.service.ts        â†’ Lesson management
â”‚   â”‚   â””â”€â”€ upload.service.ts        â†’ Upload handling
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                  ğŸ›£ï¸  Route Definitions
â”‚   â”‚   â”œâ”€â”€ index.ts                 â†’ Main router (combines all)
â”‚   â”‚   â”œâ”€â”€ auth.routes.ts           â†’ /api/auth/*
â”‚   â”‚   â”œâ”€â”€ lesson.routes.ts         â†’ /api/lessons/*
â”‚   â”‚   â”œâ”€â”€ upload.routes.ts         â†’ /api/upload/*
â”‚   â”‚   â””â”€â”€ health.routes.ts         â†’ /health
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/              ğŸ”’ Request Processing
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts       â†’ Token verification
â”‚   â”‚   â”œâ”€â”€ admin.middleware.ts      â†’ Role checking
â”‚   â”‚   â”œâ”€â”€ common.middleware.ts     â†’ Error handling, logging
â”‚   â”‚   â””â”€â”€ lesson-access.middleware.ts â†’ Access control
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                   ğŸ“ TypeScript Definitions
â”‚   â”‚   â”œâ”€â”€ index.ts                 â†’ Main exports
â”‚   â”‚   â”œâ”€â”€ api.types.ts             â†’ API response types
â”‚   â”‚   â””â”€â”€ lesson.types.ts          â†’ Lesson-specific types
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                  âš™ï¸  Configuration
â”‚   â”‚   â”œâ”€â”€ app.config.ts            â†’ App settings
â”‚   â”‚   â”œâ”€â”€ cors.config.ts           â†’ CORS settings
â”‚   â”‚   â””â”€â”€ routes.config.ts         â†’ Route configuration
â”‚   â”‚
â”‚   â””â”€â”€ utils/                   ğŸ”§ Utility Functions
â”‚       â”œâ”€â”€ database.ts              â†’ Database connection manager
â”‚       â””â”€â”€ response.helpers.ts      â†’ Response formatting
â”‚
â”œâ”€â”€ docs/                        ğŸ“š Documentation
â”‚   â”œâ”€â”€ README.md                    â†’ Documentation index
â”‚   â”œâ”€â”€ RESTRUCTURING-SUMMARY.md     â†’ Overview of changes
â”‚   â”œâ”€â”€ ARCHITECTURE.md              â†’ System architecture
â”‚   â”œâ”€â”€ API-DEVELOPMENT-GUIDE.md     â†’ Developer guide
â”‚   â”œâ”€â”€ MIGRATION-GUIDE.md           â†’ Migration instructions
â”‚   â””â”€â”€ QUICK-REFERENCE.md           â†’ Quick reference
â”‚
â”œâ”€â”€ package.json                 ğŸ“¦ Dependencies
â”œâ”€â”€ tsconfig.json                ğŸ”§ TypeScript config
â””â”€â”€ .env                         ğŸ” Environment variables
```

---

## ğŸ”„ Component Interaction Diagram

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Express Application   â”‚
                    â”‚      (index.ts)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Router (routes/)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ Auth Routes   â”‚  â”‚ Lesson â”‚  â”‚   Upload    â”‚
        â”‚               â”‚  â”‚ Routes â”‚  â”‚   Routes    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚              â”‚               â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                â”‚   â”‚                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚  Middleware     â”‚         â”‚  Middleware    â”‚
        â”‚  - auth         â”‚         â”‚  - auth        â”‚
        â”‚                 â”‚         â”‚  - admin       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Auth           â”‚         â”‚  Lesson        â”‚
        â”‚  Controller     â”‚         â”‚  Controller    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Auth           â”‚         â”‚  Lesson        â”‚
        â”‚  Service        â”‚         â”‚  Service       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                           â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PostgREST API    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PostgreSQL DB     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow Diagram

```
Client                  API Server              Database
  â”‚                         â”‚                       â”‚
  â”‚  POST /api/auth/login   â”‚                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
  â”‚  { email, password }    â”‚                       â”‚
  â”‚                         â”‚                       â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
  â”‚                    â”‚ Route    â”‚                 â”‚
  â”‚                    â”‚ Matches  â”‚                 â”‚
  â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚                         â”‚                       â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
  â”‚                    â”‚ Auth     â”‚                 â”‚
  â”‚                    â”‚Controllerâ”‚                 â”‚
  â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚                         â”‚                       â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
  â”‚                    â”‚ Auth     â”‚                 â”‚
  â”‚                    â”‚ Service  â”‚                 â”‚
  â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚                         â”‚                       â”‚
  â”‚                         â”‚  verify_login()       â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                       â”‚
  â”‚                         â”‚  { token, user }      â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                         â”‚                       â”‚
  â”‚  { success, data }      â”‚                       â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
  â”‚  Store token            â”‚                       â”‚
  â”‚                         â”‚                       â”‚
  â”‚  GET /api/lessons       â”‚                       â”‚
  â”‚  Authorization: Bearer  â”‚                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
  â”‚                         â”‚                       â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
  â”‚                    â”‚ Auth     â”‚                 â”‚
  â”‚                    â”‚Middlewareâ”‚                 â”‚
  â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚                         â”‚                       â”‚
  â”‚                         â”‚  verify_token()       â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                       â”‚
  â”‚                         â”‚  { user_id, role }    â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                         â”‚                       â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
  â”‚                    â”‚ Lesson   â”‚                 â”‚
  â”‚                    â”‚Controllerâ”‚                 â”‚
  â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
  â”‚                         â”‚                       â”‚
  â”‚  { success, data: [] }  â”‚                       â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
  â”‚                         â”‚                       â”‚
```

---

## ğŸ¯ Layer Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ROUTES LAYER                                           â”‚
â”‚  â€¢ Define HTTP endpoints                                â”‚
â”‚  â€¢ Apply middleware                                     â”‚
â”‚  â€¢ Map URLs to controller methods                       â”‚
â”‚  â€¢ NO business logic                                    â”‚
â”‚  â€¢ NO database access                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTROLLERS LAYER                                      â”‚
â”‚  â€¢ Parse request data (body, params, query)             â”‚
â”‚  â€¢ Validate input                                       â”‚
â”‚  â€¢ Call service methods                                 â”‚
â”‚  â€¢ Format responses                                     â”‚
â”‚  â€¢ Handle HTTP errors (400, 401, 404, 500)             â”‚
â”‚  â€¢ NO business logic                                    â”‚
â”‚  â€¢ NO database access                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICES LAYER                                         â”‚
â”‚  â€¢ Implement business logic                             â”‚
â”‚  â€¢ Transform data                                       â”‚
â”‚  â€¢ Coordinate multiple operations                       â”‚
â”‚  â€¢ Call external APIs                                   â”‚
â”‚  â€¢ Access database                                      â”‚
â”‚  â€¢ Independent of HTTP/Express                          â”‚
â”‚  â€¢ Reusable across endpoints                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABASE LAYER                                         â”‚
â”‚  â€¢ Store and retrieve data                              â”‚
â”‚  â€¢ Execute SQL queries                                  â”‚
â”‚  â€¢ Apply access controls                                â”‚
â”‚  â€¢ Return raw data                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Dependency Injection

```
Main Application (index.ts)
     â”‚
     â”œâ”€ Creates Database Pool
     â”‚       â”‚
     â”‚       â””â”€> DatabaseManager.getInstance()
     â”‚
     â”œâ”€ Creates Router
     â”‚       â”‚
     â”‚       â””â”€> createRouter(pool, postgrestUrl, apiKey)
     â”‚                  â”‚
     â”‚                  â”œâ”€> createAuthRoutes(pool, postgrestUrl)
     â”‚                  â”‚         â”‚
     â”‚                  â”‚         â””â”€> new AuthService(pool, postgrestUrl)
     â”‚                  â”‚                   â”‚
     â”‚                  â”‚                   â””â”€> new AuthController(authService)
     â”‚                  â”‚
     â”‚                  â”œâ”€> createLessonRoutes(postgrestUrl)
     â”‚                  â”‚         â”‚
     â”‚                  â”‚         â””â”€> new LessonService(postgrestUrl)
     â”‚                  â”‚                   â”‚
     â”‚                  â”‚                   â””â”€> new LessonController(lessonService)
     â”‚                  â”‚
     â”‚                  â””â”€> createUploadRoutes(apiKey)
     â”‚                            â”‚
     â”‚                            â””â”€> new UploadService(apiKey)
     â”‚                                      â”‚
     â”‚                                      â””â”€> new UploadController(uploadService)
     â”‚
     â””â”€ Starts Server
```

---

**Last Updated**: November 14, 2025
